{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "EncounterNote v1.0 Schema",
  "description": "JSON schema for medical encounter notes",
  "required": ["version", "timestamp", "soap", "prescription", "metadata"],
  "properties": {
    "version": {
      "type": "string",
      "enum": ["1.0"],
      "description": "Schema version"
    },
    "timestamp": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix timestamp of encounter"
    },
    "soap": {
      "$ref": "#/definitions/SOAPNote"
    },
    "prescription": {
      "$ref": "#/definitions/Prescription"
    },
    "metadata": {
      "$ref": "#/definitions/EncounterMetadata"
    }
  },
  "definitions": {
    "SOAPNote": {
      "type": "object",
      "required": ["subjective", "objective", "assessment", "plan", "confidence"],
      "properties": {
        "subjective": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1,
          "maxItems": 5,
          "description": "Subjective findings (patient complaints)"
        },
        "objective": {
          "type": "array", 
          "items": {"type": "string"},
          "minItems": 1,
          "maxItems": 5,
          "description": "Objective findings (physical exam)"
        },
        "assessment": {
          "type": "array",
          "items": {"type": "string"}, 
          "minItems": 1,
          "maxItems": 5,
          "description": "Assessment (diagnosis)"
        },
        "plan": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1, 
          "maxItems": 5,
          "description": "Plan (treatment)"
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Overall SOAP confidence score"
        }
      }
    },
    "Prescription": {
      "type": "object",
      "required": ["medications", "instructions", "confidence"],
      "properties": {
        "medications": {
          "type": "array",
          "items": {"$ref": "#/definitions/Medication"},
          "minItems": 0,
          "maxItems": 10,
          "description": "List of prescribed medications"
        },
        "instructions": {
          "type": "array",
          "items": {"type": "string"},
          "description": "General prescription instructions"
        },
        "followUp": {
          "type": ["string", "null"],
          "description": "Follow-up instructions"
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Overall prescription confidence score"
        }
      }
    },
    "Medication": {
      "type": "object",
      "required": ["name", "dosage", "frequency", "duration", "instructions", "confidence", "isGeneric"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Medication name"
        },
        "dosage": {
          "type": "string",
          "minLength": 1,
          "pattern": "^[0-9]+(\\.[0-9]+)?(mg|g|ml|units?|tabs?|capsules?)$",
          "description": "Medication dosage with units"
        },
        "frequency": {
          "type": "string",
          "minLength": 1,
          "description": "Dosing frequency"
        },
        "duration": {
          "type": "string", 
          "minLength": 1,
          "description": "Treatment duration"
        },
        "instructions": {
          "type": "string",
          "description": "Special instructions for medication"
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Medication confidence score"
        },
        "isGeneric": {
          "type": "boolean",
          "description": "Whether medication is generic"
        }
      }
    },
    "EncounterMetadata": {
      "type": "object",
      "required": ["speakerTurns", "totalDuration", "processingTime", "modelVersion", "fallbackUsed"],
      "properties": {
        "speakerTurns": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of speaker turns in conversation"
        },
        "totalDuration": {
          "type": "integer",
          "minimum": 0,
          "description": "Total conversation duration in milliseconds"
        },
        "processingTime": {
          "type": "integer", 
          "minimum": 0,
          "description": "AI processing time in milliseconds"
        },
        "modelVersion": {
          "type": "string",
          "minLength": 1,
          "description": "AI model version used"
        },
        "fallbackUsed": {
          "type": "boolean",
          "description": "Whether fallback generation was used"
        }
      }
    }
  }
}
